---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: authelia-external
  namespace: networking
spec:
  interval: 5m
  timeout: 15m
  chart:
    spec:
      chart: authelia
      version: 0.8.21
      sourceRef:
        kind: HelmRepository
        name: authelia-charts
        namespace: flux-system
      interval: 5m
  values:
    domain: kutara.io
    ingress:
      enabled: true
      certManager: true
      className: traefik
      traefikCRD:
        enabled: true
        disableIngressRoute: true
    pod:
      kind: Deployment
      replicas: 2
      extraVolumeMounts:
        - name: extra-secrets
          mountPath: /config
      extraVolumes:
        - name: extra-secrets
          secret:
            secretName: authelia-generator
    configMap:
      webauthn:
        display_name: "Kutara Authelia"
      authentication_backend:
        disable_reset_password: true
        ldap:
          enabled: false
        file:
          enabled: true
      session:
        name: authelia_external_session
        redis:
          host: redis-authelia-master
          database_index: 0
      notifier:
        smtp:
          enabledSecret: true
          host: smtp.mailgun.org
          port: 465
          username: auth@mg.kutara.io
          sender: auth@mg.kutara.io
          identifier: authelia
          startup_check_address: auth@mg.kutara.io
      storage:
        postgres:
          host: authelia-external-postgres
          database: postgres
          username: postgres
    secret:
      existingSecret: authelia-external
      
