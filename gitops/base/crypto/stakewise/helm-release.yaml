---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: stakewise-operator
  namespace: crypto
spec:
  interval: 5m
  chart:
    spec:
      chart: operator
      version: 1.0.10
      sourceRef:
        kind: HelmRepository
        name: stakewise-charts
        namespace: flux-system
      interval: 5m
  values:
    type: lighthouse
    enabled: false
    initImageBusybox:
      repository: "docker.io/library/busybox"
      tag: "1.34"
    initImage:
      repository: "europe-west4-docker.pkg.dev/stakewiselabs/public/validator-init"
      tag: "v1.0.2"
    nodeSelector:
      kubernetes.io/arch: amd64
    network: prater
    graffiti: "kutara"
    prometheusRule:
      enabled: true
      namespace: "crypto"
    persistence:
      storageClassName: ceph-block
    vaultAddr: "vault.infra.svc.cluster.local"
    geth:
      network: goerli
      replicas: 3
      metrics:
        enabled: true
        serviceMonitor:
          enabled: true
        prometheusRule:
          enabled: false
    prysm:
      network: prater
      replicas: 1
      eth1Endpoint: "http://stakewise-operator-geth.crypto.svc.cluster.local:8545"
      extraFlags:
        - "--accept-terms-of-use"
        - "--http-web3provider=http://stakewise.operator-geth.svc.cluster.local:8545"
        - "--fallback-web3provider=${CRYPTO_INFURA_ETH1_ENDPOINT_TEST}"
        - "--p2p-max-peers=100"
        - "--enable-peer-scorer"
      metrics:
        enabled: true
        serviceMonitor:
          enabled: true
        prometheusRule:
          enabled: false
    lighthouse:
      network: prater
      replicas: 3
      eth1Endpoints:
        - "http://stakewise-operator-geth:8545"
        - "${CRYPTO_INFURA_ETH1_ENDPOINT_TEST}"
      metrics:
        enabled: true
        serviceMonitor:
          enabled: true
        prometheusRule:
          enabled: false
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
      prometheusRule:
        enabled: false
  postRenderers:
    - kustomize:
        patchesJson6902:
          - target:
              version: v1
              kind: ConfigMap
              name: .*-dashboard
            patch:
              - op: add
                path: /metadata/annotations
                value:
                  grafana_folder: crypto
