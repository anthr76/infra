---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: home-namespace
  namespace: flux-system
spec:
  interval: 5m
  path: "./gitops/base/home"
  prune: true
  wait: true
  sourceRef:
    kind: GitRepository
    name: flux-system
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: home-esphome
  namespace: flux-system
spec:
  interval: 5m
  path: "./gitops/base/home/esphome"
  prune: true
  wait: true
  sourceRef:
    kind: GitRepository
    name: flux-system
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: home-zwavejs2mqtt
  namespace: flux-system
spec:
  interval: 5m
  path: "./gitops/base/home/zwavejs2mqtt"
  prune: true
  wait: true
  sourceRef:
    kind: GitRepository
    name: flux-system
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: home-emqx
  namespace: flux-system
spec:
  interval: 5m
  path: "./gitops/base/home/emqx"
  prune: true
  wait: true
  sourceRef:
    kind: GitRepository
    name: flux-system
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: home-home-assistant
  namespace: flux-system
spec:
  interval: 5m
  path: "./gitops/base/home/home-assistant"
  prune: true
  wait: true
  sourceRef:
    kind: GitRepository
    name: flux-system
  patches:
    - patch: |
        - op: add
          path: /spec/values/podAnnotations
          value:
            k8s.v1.cni.cncf.io/networks: |
              [{
                "name":"macvlan-iot-static",
                "namespace": "kube-system",
                "ips": ["192.168.12.5/24"]
              }]
      target:
        kind: HelmRelease
        name: home-assistant
        namespace: home
