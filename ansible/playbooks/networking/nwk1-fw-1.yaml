---
- name: Configure switch
  hosts: 'nwk1-fw-1.int.rabbito.tech'
  tasks:

  - name: configure interfaces
    vyos.vyos.vyos_interfaces:
      config:
      - name: eth0
        description: 'OUTSIDE'
        enabled: true
      - name: eth1
        description: 'INSIDE'
        vifs:
        - vlan_id: 10
          description: 'VLAN_10'
        - vlan_id: 99
          description: 'VLAN_99'
        - vlan_id: 100
          description: 'VLAN_100'
        - vlan_id: 101
          description: 'VLAN_101'

  - name: configure interface addresses
    vyos.vyos.vyos_config:
      lines:
      - set interfaces ethernet eth0 address 'dhcp'
      - set interfaces ethernet eth1 address '192.168.0.1/24'
      - set interfaces ethernet eth1 vif 10 address '192.168.4.1/24'
      - set interfaces ethernet eth1 vif 99 address '10.20.99.1/24'
      - set interfaces ethernet eth1 vif 100 address '192.168.3.1/24'
      - set interfaces ethernet eth1 vif 101 address '192.168.2.1/24'

  - name: configure interface NAT
    vyos.vyos.vyos_config:
      lines:
      - set nat source rule 1 outbound-interface 'eth0'
      - set nat source rule 1 source address '192.168.0.0/24'
      - set nat source rule 1 translation address 'masquerade'
      - set nat source rule 10 outbound-interface 'eth0'
      - set nat source rule 10 source address '192.168.4.0/24'
      - set nat source rule 10 translation address 'masquerade'
      - set nat source rule 99 outbound-interface 'eth0'
      - set nat source rule 99 source address '10.20.99.0/24'
      - set nat source rule 99 translation address 'masquerade'
      - set nat source rule 100 outbound-interface 'eth0'
      - set nat source rule 100 source address '192.168.3.0/24'
      - set nat source rule 100 translation address 'masquerade'
      - set nat source rule 101 outbound-interface 'eth0'
      - set nat source rule 101 source address '192.168.2.0/24'
      - set nat source rule 101 translation address 'masquerade'

  - name: configure LAN DHCP
    vyos.vyos.vyos_config:
      lines:
      - set service dhcp-server shared-network-name LAN subnet 192.168.0.0/24 default-router '192.168.0.1'
      - set service dhcp-server shared-network-name LAN subnet 192.168.0.0/24 dns-server '1.1.1.1'
      - set service dhcp-server shared-network-name LAN subnet 192.168.0.0/24 domain-name 'int.rabbito.tech'
      - set service dhcp-server shared-network-name LAN subnet 192.168.0.0/24 lease '86400'
      - set service dhcp-server shared-network-name LAN subnet 192.168.0.0/24 range 0 start '192.168.0.9'
      - set service dhcp-server shared-network-name LAN subnet 192.168.0.0/24 range 0 stop '192.168.0.254'

  - name: configure VLAN 10 DHCP
    vyos.vyos.vyos_config:
      lines:
      - set service dhcp-server shared-network-name VLAN_10 subnet 192.168.4.0/24 default-router '192.168.4.1'
      - set service dhcp-server shared-network-name VLAN_10 subnet 192.168.4.0/24 dns-server '1.1.1.1'
      - set service dhcp-server shared-network-name VLAN_10 subnet 192.168.4.0/24 domain-name 'int.rabbito.tech'
      - set service dhcp-server shared-network-name VLAN_10 subnet 192.168.4.0/24 lease '86400'
      - set service dhcp-server shared-network-name VLAN_10 subnet 192.168.4.0/24 range 0 start '192.168.4.9'
      - set service dhcp-server shared-network-name VLAN_10 subnet 192.168.4.0/24 range 0 stop '192.168.4.254'

  - name: configure VLAN 99 DHCP
    vyos.vyos.vyos_config:
      lines:
      - set service dhcp-server shared-network-name VLAN_99 subnet 10.20.99.0/24 default-router '10.20.99.1'
      - set service dhcp-server shared-network-name VLAN_99 subnet 10.20.99.0/24 dns-server '1.1.1.1'
      - set service dhcp-server shared-network-name VLAN_99 subnet 10.20.99.0/24 domain-name 'int.rabbito.tech'
      - set service dhcp-server shared-network-name VLAN_99 subnet 10.20.99.0/24 lease '86400'
      - set service dhcp-server shared-network-name VLAN_99 subnet 10.20.99.0/24 range 0 start '10.20.99.9'
      - set service dhcp-server shared-network-name VLAN_99 subnet 10.20.99.0/24 range 0 stop '10.20.99.254'

  - name: configure VLAN 100 DHCP
    vyos.vyos.vyos_config:
      lines:
      - set service dhcp-server shared-network-name VLAN_100 subnet 192.168.3.0/24 default-router '192.168.3.1'
      - set service dhcp-server shared-network-name VLAN_100 subnet 192.168.3.0/24 dns-server '1.1.1.1'
      - set service dhcp-server shared-network-name VLAN_100 subnet 192.168.3.0/24 domain-name 'int.rabbito.tech'
      - set service dhcp-server shared-network-name VLAN_100 subnet 192.168.3.0/24 lease '86400'
      - set service dhcp-server shared-network-name VLAN_100 subnet 192.168.3.0/24 range 0 start '192.168.3.9'
      - set service dhcp-server shared-network-name VLAN_100 subnet 192.168.3.0/24 range 0 stop '192.168.3.254'

  - name: configure VLAN 101 DHCP
    vyos.vyos.vyos_config:
      lines:
      - set service dhcp-server shared-network-name VLAN_101 subnet 192.168.2.0/24 default-router '192.168.2.1'
      - set service dhcp-server shared-network-name VLAN_101 subnet 192.168.2.0/24 dns-server '1.1.1.1'
      - set service dhcp-server shared-network-name VLAN_101 subnet 192.168.2.0/24 domain-name 'int.rabbito.tech'
      - set service dhcp-server shared-network-name VLAN_101 subnet 192.168.2.0/24 lease '86400'
      - set service dhcp-server shared-network-name VLAN_101 subnet 192.168.2.0/24 range 0 start '192.168.2.9'
      - set service dhcp-server shared-network-name VLAN_101 subnet 192.168.2.0/24 range 0 stop '192.168.2.254
