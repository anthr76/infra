---
- name: configure interfaces
  vyos.vyos.vyos_interfaces:
    config:
      - name: eth0
        description: "OUTSIDE"
        enabled: true
      - name: eth1
        description: "INSIDE"
        vifs:
          - vlan_id: 10
            description: "VLAN_10"
          - vlan_id: 99
            description: "VLAN_99"
          - vlan_id: 100
            description: "VLAN_100"
          - vlan_id: 101
            description: "VLAN_101"

- name: configure interface addresses
  vyos.vyos.vyos_config:
    lines:
      - set interfaces ethernet eth0 address 'dhcp'
      - set interfaces ethernet eth1 address '{{ data.LAN.GW }}/24'
      - set interfaces ethernet eth1 vif 10 address '{{ data.VLAN_10.GW }}/24'
      - set interfaces ethernet eth1 vif 99 address '{{ data.VLAN_99.GW }}/24'
      - set interfaces ethernet eth1 vif 100 address '{{ data.VLAN_100.GW }}/24'
      - set interfaces ethernet eth1 vif 101 address '{{ data.VLAN_101.GW }}/24'

- name: configure interface NAT
  vyos.vyos.vyos_config:
    lines:
      - set nat source rule 1 outbound-interface 'eth0'
      - set nat source rule 1 source address '{{ data.LAN.CIDR }}'
      - set nat source rule 1 translation address 'masquerade'
      - set nat source rule 10 outbound-interface 'eth0'
      - set nat source rule 10 source address '{{ data.VLAN_10.CIDR }}'
      - set nat source rule 10 translation address 'masquerade'
      - set nat source rule 99 outbound-interface 'eth0'
      - set nat source rule 99 source address '{{ data.VLAN_99.CIDR }}'
      - set nat source rule 99 translation address 'masquerade'
      - set nat source rule 100 outbound-interface 'eth0'
      - set nat source rule 100 source address '{{ data.VLAN_100.CIDR }}'
      - set nat source rule 100 translation address 'masquerade'
      - set nat source rule 101 outbound-interface 'eth0'
      - set nat source rule 101 source address '{{ data.VLAN_101.CIDR }}'
      - set nat source rule 101 translation address 'masquerade'
