---

- name: Assign inventory name to unconfigured hostnames
  command: "hostnamectl set-hostname {{ inventory_hostname }}"
  register: hostname_changed
- name: Set sysctl for transient hostname
  sysctl:
    name: kernel.hostname
    value: "{{ inventory_hostname }}"
    sysctl_set: yes
- name: ensure kubernetes manifests directory
  file:
    path: /etc/kubernetes/manifests
    state: directory
- name: ensure kubelet is running and enabled
  service:
    name: kubelet
    state: started
    enabled: yes
- name: Generate rebootmgr config
  template:
    src: transactional-update.conf.j2
    dest: /etc/transactional-update.conf
  notify: restart rebootmgr
- name: Install packages
  command: "transactional-update -n pkg install open-iscsi python3-rpm"
  notify: kured reboot
