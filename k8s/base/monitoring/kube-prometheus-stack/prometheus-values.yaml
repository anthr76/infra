prometheus:
  thanosService:
    enabled: true
  thanosServiceMonitor:
    enabled: true
  thanosIngress:
    enabled: true
    pathType: Prefix
    ingressClassName: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/backend-protocol: "GRPC"
      cert-manager.io/cluster-issuer: letsencrypt-production
    hosts:
      - &host "thanos-sidecar.${GENERIC_CLUSTER_INGRESS}"
    tls:
      - hosts:
          - *host
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-production
    hosts:
      - "prom.${GENERIC_CLUSTER_INGRESS}"
    tls:
      - secretName: prometheus-tls
        hosts:
          - "prom.${GENERIC_CLUSTER_INGRESS}"
  prometheusSpec:
    resources:
      requests:
        cpu: 800m
        memory: 17G
      limits:
        cpu: 2000m
        memory: 25G
    replicas: 3
    replicaExternalLabelName: "__replica__"
    externalLabels:
      cluster: scr1-cluster-0
    podAntiAffinity: hard
    ruleSelectorNilUsesHelmValues: false
    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    probeSelectorNilUsesHelmValues: false
    retentionSize: "6GB"
    retention: 2d
    walCompression: true
    enableAdminAPI: true
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: "ceph-block"
          resources:
            requests:
              storage: 10Gi
    thanos:
      image: quay.io/thanos/thanos:v0.27.0
      # renovate: datasource=docker depName=quay.io/thanos/thanos
      version: "v0.27.0"
      objectStorageConfig:
        name: thanos-objstore-secret
        key: objstore.yml
    additionalScrapeConfigs:
      - job_name: "node-exporter"
        honor_timestamps: true
        scrape_interval: 1m
        scrape_timeout: 10s
        static_configs:
          - targets:
              - fw-1.${INT_DOMAIN}:9100
              - ceph-01.${INT_DOMAIN}:9100
              - ceph-02.${INT_DOMAIN}:9100
              - ceph-03.${INT_DOMAIN}:9100
              - libvirt-01.scr1.rabbito.tech:9100
      - job_name: "vyos-coredns"
        scrape_interval: 1m
        scrape_timeout: 10s
        static_configs:
          - targets:
              - 10.5.0.7:9153
              - 10.5.0.8:9153
      - job_name: "cephadm-cluster"
        metrics_path: /metrics
        scrape_interval: 1m
        scrape_timeout: 10s
        static_configs:
          - targets:
              - "ceph-01.scr1.rabbito.tech:9283"
              - "ceph-02.scr1.rabbito.tech:9283"
              - "ceph-03.scr1.rabbito.tech:9283"
      - job_name: "vyos"
        metrics_path: /metrics
        scrape_interval: 1m
        scrape_timeout: 10s
        static_configs:
          - targets:
              - "fw-1.scr1.rabbito.tech:9273"
      - job_name: "redis"
        scrape_interval: 1m
        scrape_timeout: 10s
        static_configs:
          - targets:
              - "db-01.scr1.rabbito.tech:9121"
      - job_name: "postgres"
        scrape_interval: 1m
        scrape_timeout: 10s
        static_configs:
          - targets:
              - "db-01.scr1.rabbito.tech:9187"
