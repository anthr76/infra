include:
- template: Security/Secret-Detection.gitlab-ci.yml
- template: Security/License-Scanning.gitlab-ci.yml
- template: Terraform.latest.gitlab-ci.yml

# Rewrite Stages

license_scanning:
  stage: 💨 smoke test
  script:
    - /run.sh analyze .

.secret-analyzer:
  stage: 💨 smoke test

.init: &init
  stage: 🛠️ prep

.validate: &validate
  stage: 💨 smoke test

.build: &build
  stage: 👀 plan
  script:
    - echo "plan ready"
  artifacts:
    paths:
      - ${TF_ROOT}/plan.cache
    reports:
      terraform: ${TF_ROOT}/plan.json

.deploy: &deploy
  stage: 🚀 deploy

stages:
  - 💨 smoke test
  - 🛠️ prep
  - 👀 plan
  - 🚀 deploy

nyc1_cluster_plan:
  extends: .build
  stage: 👀 plan
  variables:
    TERRAFORM_DIRECTORY: "clusters/nyc1/iac"
  artifacts:
    name: NYC1-Cluster